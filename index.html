<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700;800&family=Rozha+One&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    /* Scope Styles */
    #tys-app-container {
        font-family: 'Noto Sans Devanagari', 'Poppins', sans-serif;
        max-width: 100%; margin: 0 auto; padding: 20px 0; box-sizing: border-box;
    }
    #tys-app-container * { box-sizing: border-box; }

    /* Controls */
    #tys-app-container .controls-box {
        background: #fff; padding: 25px; border-radius: 12px;
        border: 1px solid #e0e0e0; width: 100%; max-width: 500px; 
        margin: 0 auto 40px auto; text-align: center;
        box-shadow: 0 10px 25px rgba(0,35,71,0.1);
    }
    #tys-app-container h2 { color: #002347; margin: 0 0 20px 0; font-size: 22px; font-weight: 800; text-transform: uppercase; }
    #tys-app-container .input-field { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #eee; border-radius: 8px; font-size: 16px; font-family: 'Poppins', sans-serif; }
    #tys-app-container .btn-verify {
        background: #002347; color: white; border: none; padding: 14px 25px; 
        border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer; width: 100%;
        transition: all 0.2s; text-decoration: none; display: inline-block;
    }
    #tys-app-container .btn-verify:hover { background: #d62d20; }
    #tys-status { margin-top: 15px; font-size: 14px; color: #555; font-weight: 600; }

    /* Grid */
    #tys-grid { display: flex; flex-direction: column; gap: 40px; align-items: center; width: 100%; }
    .card-row {
        display: flex; flex-wrap: wrap; gap: 40px; justify-content: center;
        background: #f4f6f8; padding: 30px; border-radius: 15px;
        border: 1px solid #e1e4e8; width: 100%;
    }
    .btn-print-wrap { width: 100%; display: flex; justify-content: center; margin-top: 20px; }
    .btn-print { 
        background: #002347; color: white; padding: 12px 25px; border: none; 
        border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600;
        display: inline-flex; align-items: center; gap: 8px;
    }

    /* === ID CARD CSS (85.6mm x 54mm) === */
    .id-card-wrapper {
        width: 85.6mm; height: 54mm;
        position: relative; margin: 0 auto;
        border-radius: 3mm; box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    }

    .id-card-inner {
        width: 85.6mm; height: 54mm;
        background-color: #ffffff;
        background-image: radial-gradient(#002347 0.5px, transparent 0.5px), radial-gradient(#002347 0.5px, #ffffff 0.5px);
        background-size: 20px 20px; background-position: 0 0, 10px 10px; background-blend-mode: overlay;
        position: relative; overflow: hidden;
        border: 1px solid #aaa; border-radius: 3mm;
        font-family: 'Noto Sans Devanagari', sans-serif;
        display: flex; flex-direction: column; color: #000; line-height: normal;
    }

    /* HEADER */
    .h-header { 
        height: 14mm; 
        background: #002347; 
        display: flex; align-items: center; justify-content: space-between; 
        padding: 0 2mm; position: relative; z-index: 5;
        border-bottom: 1.8mm solid #d62d20; 
    }
    .h-logo, .h-cow { width: 9mm; height: 9mm; object-fit: contain; display: block; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3)); }
    .h-cow { border-radius: 50%; border: 1px solid white; background:white; }
    
    .h-titles { flex: 1; text-align: center; padding-top: 3.5mm; } 
    .h-main-title { 
        font-family: 'Rozha One', serif; font-size: 12.5pt; color: #ffffff; 
        line-height: 0.9; margin-top: 0; white-space: nowrap; 
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .h-sub-title { 
        font-family: 'Noto Sans Devanagari', sans-serif; font-size: 5pt; 
        font-weight: 700; color: #ffeb3b; line-height: 1.2; margin-top: 0.5mm; 
    }
    
    .h-tag { 
        position: absolute; top: 0; left: 50%; transform: translateX(-50%); 
        font-size: 3.5pt; background: #d62d20; color: white; padding: 1px 8px; 
        border-radius: 0 0 4px 4px; text-transform: uppercase; font-weight: 800; 
        z-index: 10;
    }

    /* BODY */
    .h-body { flex: 1; display: flex; padding: 2mm 3mm; position: relative; background: rgba(255,255,255,0.94); }
    .bg-wm { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 35mm; opacity: 0.08; pointer-events: none; z-index: 0; filter: grayscale(100%); }

    /* LEFT COLUMN */
    .h-left { width: 22mm; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
    
    .h-p-box { 
        width: 19mm; height: 23mm; background: #fff; 
        position: relative; border: 1.5px solid #002347; border-radius: 4px; overflow: hidden;
    }
    .h-p-img { width: 100%; height: 100%; object-fit: cover; }
    
    /* STAMP - FIXED BOTTOM RIGHT INSIDE PHOTO */
    .h-stamp { 
        position: absolute; bottom: 0; right: 0; width: 14mm; 
        opacity: 0.9; mix-blend-mode: multiply; transform: rotate(-15deg); z-index: 10; 
    }

    .h-bar-wrap { width: 100%; height: 5mm; display: flex; justify-content: center; margin-top: 1mm; }
    .h-bar-wrap svg { width: 100%; height: 100%; }
    
    .h-sign-box { width: 100%; text-align: center; margin-top: 0.5mm; }
    .h-sign-img { height: 6mm; width: auto; max-width: 100%; display: block; margin: 0 auto; mix-blend-mode: multiply; }
    .h-sign-lbl { 
        font-size: 3.5pt; color: #002347; font-weight: 700; 
        border-top: 0.5px solid #000; padding-top: 0.5px; display: block; width: 100%;
    }

    /* RIGHT COLUMN */
    .h-right { flex: 1; padding-left: 4mm; display: flex; flex-direction: column; position: relative; }
    
    .h-row-id { 
        font-size: 9pt; font-weight: 800; color: #d62d20; 
        border-bottom: 1px dashed #002347; margin-bottom: 1.5mm; padding-bottom: 0.5mm;
        display: block; width: 100%; text-align: center; font-family: 'Poppins', sans-serif;
    }
    
    .h-grid { display: grid; grid-template-columns: 18mm 1fr; row-gap: 1mm; font-size: 6.2pt; }
    .hl { color: #002347; font-weight: 800; margin: 0; padding: 0; }
    .hv { color: #000; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin: 0; padding: 0; }

    /* FOOTER */
    .h-footer { 
        height: 4mm; background: #002347; color: white; 
        display: flex; align-items: center; justify-content: center; 
        font-size: 3pt; font-weight: 600; text-align: center; line-height: 1.1; 
        letter-spacing: 0px; border-top: 1px solid #d62d20; white-space: nowrap;
    }

    /* BACK SIDE */
    .vb-c { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 3mm; text-align: center; background: rgba(255,255,255,0.95); }
    .h-header-back-title { margin-top: 2mm; color: white; font-family: 'Noto Sans Devanagari'; font-size: 10pt; font-weight: 700; }
    
    .vb-qr { width: 25mm; height: 25mm; border: 1.5px solid #002347; padding: 1px; margin-bottom: 2mm; background: white; border-radius: 4px; }
    .vb-qr img { width: 100%; height: 100%; display: block; }
    .vb-t { font-size: 8pt; font-weight: 800; color: #002347; margin-bottom: 1mm; text-transform: uppercase; }
    .vb-s { font-size: 5.5pt; color: #444; width: 85%; font-weight: 600; line-height: 1.3; }
</style>

<div id="tys-app-container">
    <div class="controls-box">
        <h2><i class="fa-solid fa-address-card"></i> आईडी कार्ड सत्यापन</h2>
        <input type="text" id="tysInputId" class="input-field" placeholder="Member ID (e.g. 1)">
        <input type="text" id="tysInputPhone" class="input-field" placeholder="Phone (e.g. 9728765765)">
        <button class="btn-verify" onclick="tysVerify()">
            <i class="fa-solid fa-check-circle"></i> Verify & Generate
        </button>
        <div id="tys-status">सिस्टम तैयार है...</div>
    </div>

    <div id="tys-grid"></div>
</div>

<script>
    // === CONFIGURATION ===
    const EXCEL_URL = "https://docs.google.com/spreadsheets/d/1ehEiwGskDIHwUHJMSWrbjpSsaA8fTSkJ6hfuFLV3jhI/export?format=csv";
    const SIGN_URL = "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj72nNAiChUf9ROOPiYDrwg4RSatVygGQEt7yW1lOmQosfBW9MB2V3qZAcYcOHH-0bAb_2QBZSUsL_9xdVIdpZdvVOha0czW1ssESptg8Mg3X6W8K1DuyPio_oh6X4DdNH2xUhRc2fX1AkpJh2RuPYl5b0a16nYSTgGrkQnKuwYvz3lsQ/s1600/Lokesh%20Stamp.jpg";

    const ASSETS = {
        logo: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhCaJCRPLvQgi9REoAvb9b4H4Vvh6RhAmMRGwGEolXIqS2nxxCa9-jS7qexF2JL5puwPOEk-2q7ubDKeL-m-BM0_7_uHrI5EnBXue7deGtgta4UyCDnI43AkB1KBN8PV4G00fg1vW2La338AyzZkHvXpzt49papqeYLt9NDXMcTnvsceg/s1600/TYS-White.png",
        cow: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4jRFVp4bz-d45e1q-rgRwa4yOre7RBcKtS-dxVu9ayVmpGTs8rHNx6M8xnO5zLkvS7_MOU2_l6k5i6J56mN5FymgLK9IE5eIDdfp2aNEB3xmrAHp8YzzRJ-5OZeT0-uRI_eeo3gE-ZQNFK-FuHmr9Cl_gYVVeFE7bHljkejal8S2LBw/s1600/cow-calf-image.jpg",
        stamp: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj72nNAiChUf9ROOPiYDrwg4RSatVygGQEt7yW1lOmQosfBW9MB2V3qZAcYcOHH-0bAb_2QBZSUsL_9xdVIdpZdvVOha0czW1ssESptg8Mg3X6W8K1DuyPio_oh6X4DdNH2xUhRc2fX1AkpJh2RuPYl5b0a16nYSTgGrkQnKuwYvz3lsQ/s1600/Lokesh%20Stamp.jpg"
    };

    const FIELDS = {
        id: "id", first: "firstname", last: "lastname", father: "father_name",
        phone: "phone", dob: "dob", blood: "blood_group", address: "address",
        validity: "validity", photo: "photo_url", qr_data: "qr_url", designation: "designation"
    };

    let TYS_DATA = [];

    document.addEventListener("DOMContentLoaded", function() {
        loadTysData();
    });

    function getProxy(url) {
        if(!url) return "https://via.placeholder.com/150";
        return `https://wsrv.nl/?url=${encodeURIComponent(url)}&output=png`;
    }

    async function loadTysData() {
        const status = document.getElementById('tys-status');
        if(!status) return;
        status.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> डेटा लोड हो रहा है...';
        try {
            const resp = await fetch(EXCEL_URL + "&t=" + Date.now());
            const buffer = await resp.arrayBuffer();
            const decoder = new TextDecoder("utf-8");
            const csvData = decoder.decode(buffer);
            const workbook = XLSX.read(csvData, {type: 'string'});
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            TYS_DATA = XLSX.utils.sheet_to_json(sheet);
            status.innerHTML = `<span style="color:green">✅ डेटाबेस कनेक्ट हो गया।</span>`;
        } catch (e) {
            console.error(e);
            status.innerHTML = '<span style="color:red">❌ कनेक्शन विफल।</span>';
        }
    }

    function formatDate(val) {
        if (!val) return "";
        const d = new Date(val);
        if (isNaN(d.getTime())) return val; 
        return `${d.getDate().toString().padStart(2,'0')}-${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getFullYear()}`;
    }

    function tysVerify() {
        let inId = document.getElementById('tysInputId').value.trim().toLowerCase();
        let inPhone = document.getElementById('tysInputPhone').value.trim();
        const grid = document.getElementById('tys-grid');
        const status = document.getElementById('tys-status');

        if (!inId || !inPhone) {
            status.innerText = "कृपया दोनों विवरण भरें।";
            return;
        }

        const found = TYS_DATA.find(m => {
            const mId = String(m[FIELDS.id]||'').trim().toLowerCase();
            const mPh = String(m[FIELDS.phone]||'').trim();
            return mId.includes(inId) && mPh.includes(inPhone);
        });

        if (!found) {
            status.innerHTML = '<span style="color:red">❌ विवरण गलत है।</span>';
            grid.innerHTML = '';
            return;
        }

        status.innerHTML = '<span style="color:green">✅ सत्यापन सफल!</span>';
        tysRender(found);
    }

    function tysRender(data) {
        const grid = document.getElementById('tys-grid');
        const fullID = data[FIELDS.id] || "000"; 
        const name = `${data[FIELDS.first] || ''} ${data[FIELDS.last] || ''}`.trim();
        const father = data[FIELDS.father] || "";
        const phone = data[FIELDS.phone] || "";
        const dob = formatDate(data[FIELDS.dob]) || "________";
        const validityDate = formatDate(data[FIELDS.validity]) || "Lifetime";
        const address = data[FIELDS.address] || "गांव खांडा";
        const blood = data[FIELDS.blood] || "";
        const designation = data[FIELDS.designation] || "सदस्य";
        
        let qrText = data[FIELDS.qr_data];
        if (!qrText) qrText = `https://www.tirangayuvasamiti.org/verify?id=${fullID}`;

        const photoUrl = getProxy(data[FIELDS.photo]);
        const logoUrl = getProxy(ASSETS.logo);
        const cowUrl = getProxy(ASSETS.cow);
        const stampUrl = getProxy(ASSETS.stamp);
        const signatureUrl = getProxy(SIGN_URL);

        const safeId = fullID.replace(/[^a-zA-Z0-9]/g, ''); 
        const frontId = `cf-${safeId}`;
        const backId = `cb-${safeId}`;

        grid.innerHTML = `
            <div class="card-row">
                <div>
                    <div style="text-align:center; font-weight:bold; color:#002347; margin-bottom:5px;">FRONT SIDE</div>
                    <div class="id-card-wrapper">
                        <div class="id-card-inner" id="${frontId}">
                            <div class="h-header">
                                <div class="h-tag">पहचान पत्र</div>
                                <img src="${logoUrl}" class="h-logo" crossorigin="anonymous">
                                <div class="h-titles">
                                    <div class="h-main-title">गो रक्षा दल (हरियाणा)</div>
                                    <div class="h-sub-title">तिरंगा युवा समिति (पंजी. सं. 01820)<br>गांव खांडा, तहसील खरखौदा, सोनीपत (हरियाणा)</div>
                                </div>
                                <img src="${cowUrl}" class="h-cow" crossorigin="anonymous">
                            </div>
                            <div class="h-body">
                                <img src="${logoUrl}" class="bg-wm" crossorigin="anonymous">
                                <div class="h-left">
                                    <div class="h-p-box">
                                        <img src="${photoUrl}" class="h-p-img" crossorigin="anonymous">
                                        <img src="${stampUrl}" class="h-stamp" crossorigin="anonymous">
                                    </div>
                                    <div class="h-bar-wrap"><svg id="bar-${safeId}"></svg></div>
                                    <div class="h-sign-box">
                                        <img src="${signatureUrl}" class="h-sign-img" crossorigin="anonymous"> 
                                        <span class="h-sign-lbl">(अधिकृत हस्ताक्षर)</span>
                                    </div>
                                </div>
                                <div class="h-right">
                                    <div class="h-row-id">क्रमांक: ${fullID}</div>
                                    <div class="h-grid">
                                        <div class="hl">नाम:</div><div class="hv" style="font-size:8pt; color:#002347;">${name}</div>
                                        <div class="hl">पिता का नाम:</div><div class="hv">${father}</div>
                                        <div class="hl">जन्म तिथि:</div><div class="hv">${dob}</div>
                                        <div class="hl">पद:</div><div class="hv"><span style="background:#d62d20; color:white; padding:1px 5px; border-radius:3px; display:inline-block; font-size:6pt; line-height:1.2;">${designation}</span></div>
                                        <div class="hl">मोबाइल:</div><div class="hv">${phone}</div>
                                        <div class="hl">पता:</div><div class="hv" style="font-size:5pt; line-height:1.2; white-space:normal;">${address}</div>
                                        <div class="hl">वैधता:</div>
                                        <div class="hv" style="display:flex; justify-content:space-between;">
                                            <span>${validityDate}</span>
                                            <span style="font-size:5.5pt; color:#d62d20; font-weight:800;">रक्त समूह: <span style="color:black;">${blood}</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="h-footer">संपर्क सूत्र: +91 90535 75169 | info@tirangayuvasamiti.org | www.tirangayuvasamiti.org</div>
                        </div>
                    </div>
                </div>
                <div>
                    <div style="text-align:center; font-weight:bold; color:#002347; margin-bottom:5px;">BACK SIDE</div>
                    <div class="id-card-wrapper">
                        <div class="id-card-inner" id="${backId}">
                            <div class="h-header" style="justify-content:center; background:#002347; border-bottom: 2mm solid #d62d20;">
                                <div class="h-header-back-title">सत्यापन और नियम</div>
                            </div>
                            <div class="h-body vb-c">
                                <div class="vb-t">सदस्यता सत्यापित करने के लिए स्कैन करें</div>
                                <div id="qr-${safeId}" class="vb-qr"></div>
                                <div class="vb-s">यह कार्ड तिरंगा युवा समिति की संपत्ति है।<br>गुम होने पर कृपया उपरोक्त पते पर लौटाएं।</div>
                                <div style="margin-top:2mm; font-weight:800; color:#d62d20; font-size: 6.5pt; white-space: nowrap;">जय हिंद - जय भारत - जय गौ माता</div>
                            </div>
                            <div class="h-footer">Together We Serve • Go Raksha Dal Haryana</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="btn-print-wrap">
                <button class="btn-print" onclick="tysPrintNew('${frontId}', '${backId}')"><i class="fa-solid fa-print"></i> प्रिंट आईडी कार्ड</button>
            </div>
        `;

        setTimeout(() => {
            JsBarcode(`#bar-${safeId}`, fullID, { format: "CODE128", displayValue: false, height: 25, width: 1.0, margin: 0, background: "transparent" });
            new QRCode(document.getElementById(`qr-${safeId}`), { text: qrText, width: 90, height: 90, correctLevel: QRCode.CorrectLevel.M });
        }, 100);
    }

    // === PRINT LOGIC FOR A4 EASY CUT ===
    function tysPrintNew(fid, bid) {
        const frontHTML = document.getElementById(fid).outerHTML;
        const backHTML = document.getElementById(bid).outerHTML;
        const win = window.open('', '_blank', 'width=900,height=800');
        
        win.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Print ID Card</title>
                <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700;800&family=Rozha+One&display=swap" rel="stylesheet">
                <style>
                    @page { size: A4; margin: 10mm; }
                    html, body { margin: 0; padding: 20px; background: #fff; font-family: 'Noto Sans Devanagari', sans-serif; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
                    
                    /* Print Container - Centered on A4 with Cut Lines */
                    .print-container {
                        width: 100%;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        gap: 10mm; /* Space between cards for cutting */
                    }

                    .cut-wrapper {
                        border: 1px dashed #999; /* Easy to Cut Line */
                        padding: 1px;
                        display: inline-block;
                    }

                    .id-card-inner { 
                        width: 85.6mm; height: 54mm; 
                        background: white; position: relative; overflow: hidden; 
                        border: none; display: flex; flex-direction: column; line-height: normal;
                    }

                    /* REPLICATE EXACT CSS CLASSES */
                    .h-header { height: 14mm; background: #002347; display: flex; align-items: center; justify-content: space-between; padding: 0 2mm; position: relative; z-index: 5; border-bottom: 1.8mm solid #d62d20; }
                    .h-logo, .h-cow { width: 9mm; height: 9mm; object-fit: contain; } .h-cow { border-radius: 50%; border: 1px solid white; }
                    .h-titles { flex: 1; text-align: center; padding-top: 3.5mm; }
                    .h-main-title { font-family: 'Rozha One', serif; font-size: 12.5pt; color: white; line-height: 0.9; margin:0; white-space: nowrap; }
                    .h-sub-title { font-size: 5pt; font-weight: 700; color: #ffeb3b; line-height: 1.2; margin-top: 0.5mm; }
                    .h-tag { position: absolute; top: 0; left: 50%; transform: translateX(-50%); font-size: 3.5pt; background: #d62d20; color: white; padding: 1px 8px; border-radius: 0 0 4px 4px; text-transform: uppercase; font-weight: 800; z-index:10; }
                    
                    .h-body { flex: 1; display: flex; padding: 2mm 3mm; position: relative; background: rgba(255,255,255,0.94); }
                    .bg-wm { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 35mm; opacity: 0.08; z-index: 0; }
                    
                    .h-left { width: 22mm; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
                    .h-p-box { width: 19mm; height: 23mm; background: #fff; position: relative; border: 1.5px solid #002347; border-radius: 4px; overflow: hidden; }
                    .h-p-img { width: 100%; height: 100%; object-fit: cover; }
                    .h-stamp { position: absolute; bottom: 0; right: 0; width: 14mm; opacity: 0.9; mix-blend-mode: multiply; transform: rotate(-15deg); z-index: 10; }
                    
                    .h-bar-wrap { width: 100%; height: 5mm; display:flex; justify-content:center; margin-top:1mm; } .h-bar-wrap svg { width:100%; height:100%; }
                    .h-sign-box { width: 100%; text-align: center; margin-top: 0.5mm; }
                    .h-sign-img { height: 6mm; width: auto; max-width: 100%; display: block; margin: 0 auto; mix-blend-mode: multiply; }
                    .h-sign-lbl { font-size: 3.5pt; color: #002347; font-weight: 700; border-top: 0.5px solid #000; padding-top: 0.5px; display: block; width: 100%; }
                    
                    .h-right { flex: 1; padding-left: 4mm; display: flex; flex-direction: column; position: relative; }
                    .h-row-id { font-size: 9pt; font-weight: 800; color: #d62d20; border-bottom: 1px dashed #002347; margin-bottom: 1.5mm; padding-bottom: 0.5mm; display: block; width: 100%; text-align: center; }
                    
                    .h-grid { display: grid; grid-template-columns: 18mm 1fr; row-gap: 1mm; font-size: 6.2pt; }
                    .hl { color: #002347; font-weight: 800; } .hv { color: #000; font-weight: 700; white-space: nowrap; overflow: hidden; }
                    
                    .h-footer { height: 4mm; background: #002347; color: white; display: flex; align-items: center; justify-content: center; font-size: 3pt; font-weight: 600; text-align: center; line-height: 1.1; border-top: 1px solid #d62d20; white-space: nowrap; }
                    
                    .h-header-back-title { margin-top: 2mm; color: white; font-family: 'Noto Sans Devanagari'; font-size: 10pt; font-weight: 700; }
                    .vb-c { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 3mm; text-align: center; }
                    .vb-qr { width: 25mm; height: 25mm; border: 1.5px solid #002347; padding: 1px; margin-bottom: 2mm; border-radius: 4px; } .vb-qr img { width: 100%; height: 100%; }
                    .vb-t { font-size: 8pt; font-weight: 800; color: #002347; margin-bottom: 1mm; text-transform: uppercase; }
                    .vb-s { font-size: 5.5pt; color: #444; width: 85%; font-weight: 600; line-height: 1.3; }
                </style>
            </head>
            <body>
                <div class="print-container">
                    <div class="cut-wrapper">${frontHTML}</div>
                    <div class="cut-wrapper">${backHTML}</div>
                </div>
            </body>
            </html>
        `);
        win.document.close();
        
        win.onload = function() {
            setTimeout(() => {
                win.focus();
                win.print();
            }, 1000);
        };
    }
</script>
