<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlexOMR | Industrial Sheet Generator</title>
    
    <meta name="description" content="Professional A4 OMR Sheet Generator. Fully customizable, print-ready, and mobile responsive.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: { dark: '#0f172a', accent: '#3b82f6', text: '#e2e8f0' },
                        omr: { red: '#ff003c', black: '#000000' }
                    }
                }
            }
        }
    </script>

    <style>
        /* --- CORE UI STYLES --- */
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 3px; }

        /* Inputs */
        .input-dark {
            background: #1e293b; border: 1px solid #334155; color: white;
            padding: 8px; border-radius: 4px; font-size: 0.9rem; width: 100%;
        }
        .input-dark:focus { border-color: #3b82f6; outline: none; }
        
        /* Buttons */
        .btn-primary {
            background: #3b82f6; color: white; padding: 8px 16px; border-radius: 6px;
            font-weight: 600; transition: all 0.2s;
        }
        .btn-primary:hover { background: #2563eb; }
        .btn-danger { background: #ef4444; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; }

        /* --- OMR SHEET PHYSICS (Strict A4) --- */
        #preview-stage {
            background: #334155;
            overflow: auto;
            display: flex;
            justify-content: center;
            padding: 40px;
            height: 100vh;
        }

        .sheet-container {
            width: 210mm;
            min-height: 297mm; /* A4 Height */
            background: white;
            color: black;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            padding: 10mm; /* Safe print margin */
            box-sizing: border-box;
            transform-origin: top center;
            transition: transform 0.2s;
        }

        /* OMR Elements */
        .omr-color { color: #ff003c; border-color: #ff003c; }
        .omr-border { border: 1px solid #ff003c; }
        .omr-border-2 { border: 2px solid #ff003c; }
        
        .bubble {
            width: 13px; height: 13px;
            border: 1px solid #ff003c;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 8px; color: #ff003c; font-weight: bold;
        }

        .fiducial {
            position: absolute; width: 20px; height: 20px;
            border-style: solid; border-color: black; z-index: 99;
        }
        .f-tl { top: 5mm; left: 5mm; border-width: 5px 0 0 5px; }
        .f-tr { top: 5mm; right: 5mm; border-width: 5px 5px 0 0; }
        .f-bl { bottom: 5mm; left: 5mm; border-width: 0 0 5px 5px; }
        .f-br { bottom: 5mm; right: 5mm; border-width: 0 5px 5px 0; }

        /* --- PRINT MEDIA QUERY (The Magic) --- */
        @media print {
            body * { visibility: hidden; }
            #sheet-render, #sheet-render * { visibility: visible; }
            #sheet-render {
                position: absolute; left: 0; top: 0;
                width: 210mm; height: 297mm;
                margin: 0; padding: 10mm;
                transform: none !important;
                box-shadow: none;
                overflow: hidden;
            }
            @page { size: A4; margin: 0; }
        }
    </style>
</head>
<body class="flex flex-col md:flex-row h-screen">

    <button onclick="toggleSidebar()" class="md:hidden fixed top-4 right-4 z-50 bg-blue-600 text-white p-2 rounded-full shadow-lg">
        <i class="fa-solid fa-bars"></i>
    </button>

    <aside id="sidebar" class="w-full md:w-[400px] bg-[#0f172a] border-r border-gray-800 flex flex-col h-full absolute md:relative z-40 transform -translate-x-full md:translate-x-0 transition-transform duration-300">
        
        <div class="p-4 border-b border-gray-800 bg-[#1e293b]">
            <h1 class="text-xl font-bold text-blue-400"><i class="fa-solid fa-file-contract"></i> FlexOMR Generator</h1>
            <p class="text-xs text-gray-400 mt-1">Industrial A4 Standard (210x297mm)</p>
        </div>

        <div class="flex-1 overflow-y-auto p-4 space-y-6">
            
            <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                <h3 class="text-sm font-bold text-blue-400 mb-2 uppercase">1. Header Details</h3>
                <div class="space-y-2">
                    <input type="text" id="instName" class="input-dark" placeholder="Institute Name" value="NATIONAL TESTING AGENCY">
                    <input type="text" id="examName" class="input-dark" placeholder="Exam Name" value="ENTRANCE EXAMINATION 2026">
                    <div class="flex gap-2">
                        <input type="text" id="date" class="input-dark" placeholder="Date" value="24/01/2026">
                        <input type="text" id="centerCode" class="input-dark" placeholder="Center Code" value="DL-01">
                    </div>
                </div>
            </div>

            <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-sm font-bold text-green-400 uppercase">2. Student Fields</h3>
                    <button onclick="addField()" class="text-xs bg-green-600 text-white px-2 py-1 rounded hover:bg-green-500">+ Add Field</button>
                </div>
                <div id="field-list" class="space-y-2">
                    </div>
                <p class="text-[10px] text-gray-500 mt-2">Add fields like "Caste", "Section", or "Father's Name".</p>
            </div>

            <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                <h3 class="text-sm font-bold text-purple-400 mb-2 uppercase">3. Exam Configuration</h3>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <div>
                        <label class="text-xs text-gray-400">Roll No Digits</label>
                        <input type="number" id="rollDigits" class="input-dark" value="7" min="1" max="10">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">Booklet Set</label>
                        <select id="bookletSet" class="input-dark">
                            <option value="4">A-D (4)</option>
                            <option value="0">None</option>
                        </select>
                    </div>
                </div>
                <div class="space-y-2">
                    <input type="text" id="qrText" class="input-dark" placeholder="QR Value" value="OMR-SECURE-882">
                    <input type="text" id="barText" class="input-dark" placeholder="Barcode Value" value="88291002">
                </div>
            </div>

            <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                <h3 class="text-sm font-bold text-pink-400 mb-2 uppercase">4. Questions Grid</h3>
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="text-xs text-gray-400">Total Qs</label>
                        <input type="number" id="totalQs" class="input-dark" value="100">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">Columns</label>
                        <select id="gridCols" class="input-dark">
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">Options</label>
                        <select id="optCount" class="input-dark">
                            <option value="4">ABCD</option>
                            <option value="5">ABCDE</option>
                        </select>
                    </div>
                </div>
            </div>

        </div>

        <div class="p-4 border-t border-gray-800 bg-[#1e293b] flex gap-2">
            <button onclick="renderOMR()" class="flex-1 btn-primary bg-gray-600 hover:bg-gray-500"><i class="fa-solid fa-rotate"></i> Refresh</button>
            <button onclick="window.print()" class="flex-1 btn-primary bg-pink-600 hover:bg-pink-500"><i class="fa-solid fa-print"></i> Print</button>
        </div>
    </aside>

    <main class="flex-1 relative bg-gray-600" id="preview-stage">
        
        <div class="fixed top-4 right-8 z-30 bg-black/50 backdrop-blur rounded p-1 flex items-center gap-2 text-white">
            <button onclick="changeZoom(-0.1)" class="w-6 h-6 hover:text-blue-400">-</button>
            <span id="zoom-val" class="text-xs font-mono">100%</span>
            <button onclick="changeZoom(0.1)" class="w-6 h-6 hover:text-blue-400">+</button>
        </div>

        <div id="sheet-render" class="sheet-container">
            <div class="fiducial f-tl"></div>
            <div class="fiducial f-tr"></div>
            <div class="fiducial f-bl"></div>
            <div class="fiducial f-br"></div>

            <div class="h-full flex flex-col justify-between">
                
                <header class="flex justify-between items-center border-b-2 border-[#ff003c] pb-2 mb-2">
                    <div class="w-20 h-20 border border-gray-300 flex items-center justify-center text-[10px] text-gray-400">
                        STICKER / LOGO
                    </div>
                    <div class="text-center flex-1 px-4">
                        <h1 class="text-xl font-black uppercase tracking-wider" id="out-inst">INSTITUTE NAME</h1>
                        <h2 class="text-lg font-bold text-[#ff003c] uppercase" id="out-exam">EXAM NAME</h2>
                        <div class="flex justify-center gap-4 text-[10px] mt-1 font-bold">
                            <span>DATE: <span id="out-date" class="text-black font-normal">--</span></span>
                            <span>CENTER CODE: <span id="out-center" class="text-black font-normal">--</span></span>
                        </div>
                    </div>
                    <div id="qrcode-box"></div>
                </header>

                <section class="flex gap-4 mb-2">
                    
                    <div class="flex-1 space-y-2">
                        <div id="out-dynamic-fields" class="space-y-1"></div>

                        <div class="border border-gray-800 p-2 text-[9px] leading-tight">
                            <strong>INSTRUCTIONS TO CANDIDATE:</strong>
                            <ul class="list-disc pl-3 mt-1">
                                <li>Use Blue/Black Ball Point Pen only.</li>
                                <li>Darken bubbles completely. Do not use stray marks.</li>
                                <li>Partial filling or overfilling will not be read by the scanner.</li>
                            </ul>
                            <div class="flex gap-2 mt-1 items-center">
                                <span>Correct: <span class="bubble bg-black border-black"></span></span>
                                <span>Wrong: <span class="bubble"><i class="fa-solid fa-xmark text-[8px]"></i></span></span>
                            </div>
                        </div>
                    </div>

                    <div class="w-[35%] flex gap-2">
                        <div class="border border-[#ff003c] p-1 flex-1">
                            <div class="text-center text-[10px] font-bold text-[#ff003c] mb-1">ROLL NO.</div>
                            <div class="flex justify-center gap-[2px]" id="out-roll-grid"></div>
                        </div>
                        
                        <div class="border border-[#ff003c] p-1 w-12 hidden" id="out-booklet-box">
                            <div class="text-center text-[10px] font-bold text-[#ff003c] mb-1">SET</div>
                            <div class="flex flex-col items-center gap-1">
                                <span class="bubble">A</span>
                                <span class="bubble">B</span>
                                <span class="bubble">C</span>
                                <span class="bubble">D</span>
                            </div>
                        </div>
                    </div>
                </section>

                <div class="w-full flex justify-center py-1">
                    <svg id="barcode-svg"></svg>
                </div>

                <section class="flex-1 border-t-2 border-b-2 border-[#ff003c] py-2 relative">
                    <div class="absolute left-[-8mm] top-0 bottom-0 w-[5px] flex flex-col justify-between py-2" id="timing-track"></div>

                    <div class="flex h-full gap-2" id="out-question-grid">
                        </div>
                </section>

                <footer class="pt-2 h-20">
                    <div class="grid grid-cols-4 gap-4 h-full">
                        <div class="border border-gray-400 p-1 flex flex-col justify-end">
                            <span class="text-[8px] uppercase border-t border-gray-300 pt-1">Candidate Sig.</span>
                        </div>
                        <div class="border border-gray-400 p-1 flex flex-col justify-end">
                            <span class="text-[8px] uppercase border-t border-gray-300 pt-1">Invigilator Sig.</span>
                        </div>
                        <div class="border border-gray-400 p-1 flex flex-col justify-end">
                            <span class="text-[8px] uppercase border-t border-gray-300 pt-1">Thumb Impression</span>
                        </div>
                        <div class="border border-gray-400 p-1 flex items-center justify-center">
                            <span class="text-[9px] text-gray-400">INSTITUTE STAMP</span>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
    </main>

    <script>
        // --- CONFIG & STATE ---
        let currentZoom = 1;
        // Default fields
        let customFields = [
            { id: 1, name: "Student Name", type: "text" },
            { id: 2, name: "Mobile No", type: "text" }
        ];

        // --- INIT ---
        window.onload = function() {
            renderFieldList();
            renderOMR();
        }

        // --- UI FUNCTIONS ---
        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            sb.classList.toggle('-translate-x-full');
        }

        function changeZoom(delta) {
            currentZoom += delta;
            if(currentZoom < 0.4) currentZoom = 0.4;
            if(currentZoom > 1.8) currentZoom = 1.8;
            document.getElementById('zoom-val').innerText = Math.round(currentZoom*100) + '%';
            document.getElementById('sheet-render').style.transform = `scale(${currentZoom})`;
        }

        // --- DYNAMIC FIELDS LOGIC ---
        function addField() {
            const name = prompt("Enter Field Name (e.g. Father's Name, Section, Caste):");
            if(name) {
                customFields.push({ id: Date.now(), name: name, type: 'text' });
                renderFieldList();
                renderOMR();
            }
        }

        function removeField(id) {
            customFields = customFields.filter(f => f.id !== id);
            renderFieldList();
            renderOMR();
        }

        function renderFieldList() {
            const container = document.getElementById('field-list');
            container.innerHTML = customFields.map(f => `
                <div class="flex justify-between items-center bg-gray-700 p-2 rounded text-xs">
                    <span>${f.name}</span>
                    <button onclick="removeField(${f.id})" class="text-red-400 hover:text-red-300">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        // --- CORE RENDERER ---
        function renderOMR() {
            // 1. Header Text
            document.getElementById('out-inst').innerText = document.getElementById('instName').value;
            document.getElementById('out-exam').innerText = document.getElementById('examName').value;
            document.getElementById('out-date').innerText = document.getElementById('date').value;
            document.getElementById('out-center').innerText = document.getElementById('centerCode').value;

            // 2. Custom Fields Render
            const fieldContainer = document.getElementById('out-dynamic-fields');
            fieldContainer.innerHTML = customFields.map(f => `
                <div class="flex border omr-color">
                    <div class="bg-[#ff003c] text-white px-2 py-1 text-[9px] font-bold w-24 flex items-center uppercase">${f.name}</div>
                    <div class="flex-1 p-1"><div class="border-b border-dotted border-gray-400 h-full w-full"></div></div>
                </div>
            `).join('');

            // 3. Roll No Grid
            const digits = parseInt(document.getElementById('rollDigits').value);
            let rollHtml = '';
            for(let i=0; i<digits; i++) {
                let col = `<div class="flex flex-col gap-[1px]">
                             <div class="w-3 h-4 border border-gray-400 mb-[2px]"></div>`;
                for(let n=0; n<=9; n++) col += `<span class="bubble">${n}</span>`;
                col += `</div>`;
                rollHtml += col;
            }
            document.getElementById('out-roll-grid').innerHTML = rollHtml;

            // 4. Booklet
            const bookletVal = document.getElementById('bookletSet').value;
            document.getElementById('out-booklet-box').style.display = bookletVal === '0' ? 'none' : 'block';

            // 5. Codes
            document.getElementById('qrcode-box').innerHTML = "";
            new QRCode(document.getElementById('qrcode-box'), {
                text: document.getElementById('qrText').value,
                width: 50, height: 50
            });
            JsBarcode("#barcode-svg", document.getElementById('barText').value, {
                height: 25, width: 1.5, displayValue: true, fontSize: 10
            });

            // 6. Question Grid Logic
            const totalQs = parseInt(document.getElementById('totalQs').value);
            const cols = parseInt(document.getElementById('gridCols').value);
            const optCount = parseInt(document.getElementById('optCount').value);
            const qsPerCol = Math.ceil(totalQs / cols);
            const options = ['A','B','C','D','E'].slice(0, optCount);
            
            let gridHtml = '';
            for(let c=0; c<cols; c++) {
                gridHtml += `<div class="flex-1 border-r last:border-0 border-gray-300 pr-1 pl-1">
                                <div class="flex text-[9px] font-bold border-b border-gray-400 mb-1">
                                    <span class="w-5">Q</span>
                                    <span class="flex-1 text-center">ANS</span>
                                </div>`;
                
                for(let q=0; q<qsPerCol; q++) {
                    const qNum = (c * qsPerCol) + q + 1;
                    if(qNum > totalQs) break;
                    
                    gridHtml += `<div class="flex items-center mb-[2px]">
                                    <span class="w-5 text-[9px] font-bold text-center">${qNum}</span>
                                    <div class="flex gap-1 justify-center flex-1">
                                        ${options.map(o => `<span class="bubble">${o}</span>`).join('')}
                                    </div>
                                 </div>`;
                }
                gridHtml += `</div>`;
            }
            document.getElementById('out-question-grid').innerHTML = gridHtml;

            // 7. Timing Track (Visual only)
            const track = document.getElementById('timing-track');
            track.innerHTML = '';
            for(let i=0; i<30; i++) {
                track.innerHTML += `<div class="w-full h-[3px] bg-black"></div>`;
            }
        }
    </script>
</body>
</html>
